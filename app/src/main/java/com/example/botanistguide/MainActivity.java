package com.example.botanistguide;

import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.view.View;

import androidx.activity.EdgeToEdge;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.graphics.Insets;
import androidx.core.view.ViewCompat;
import androidx.core.view.WindowInsetsCompat;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;

import java.lang.reflect.Type;
import java.util.ArrayList;
import java.util.List;

public class MainActivity extends AppCompatActivity {
    public static   ArrayList<Plant> plantArrayList = new ArrayList<>();

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        EdgeToEdge.enable(this);
        setContentView(R.layout.activity_main);
        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -> {
            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());
            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);
            return insets;
        });
        if(plantArrayList.isEmpty()){
            addSavedPlants();
        }

        if(plantArrayList.isEmpty()){
            setData();
        }
        recyclerViewSet();
    }

    @Override
    protected void onStop() {
        super.onStop();
        Gson gson = new Gson();
        String json = gson.toJson(plantArrayList);
        SharedPreferences prefs = getSharedPreferences("my_prefs", MODE_PRIVATE);
        prefs.edit().putString("plants_list", json).apply();
    }

    private void  recyclerViewSet(){
        RecyclerView recyclerView = findViewById(R.id.recyclerViewPlant);
        recyclerView.setLayoutManager(new LinearLayoutManager(this));
        PlantRecyclerAdapter adapter = new PlantRecyclerAdapter(this, plantArrayList);
        recyclerView.setAdapter(adapter);
        adapter.setOnItemClickListener((plant, position)->{
            Intent intent = new Intent(MainActivity.this, DescriptionActivity.class);
            intent.putExtra("id",position);
            startActivity(intent);
        });
    }
    public void createButtonOnClick(View v){
        Intent intent = new Intent(MainActivity.this,CreateActivity.class);
        startActivity(intent);
    }

    private void addSavedPlants(){
        SharedPreferences prefs = getSharedPreferences("my_prefs", MODE_PRIVATE);
        Gson gson = new Gson();
        String json = prefs.getString("plants_list", "");
        Type type = new TypeToken<List<Plant>>() {}.getType();
        List<Plant> savedPlants = gson.fromJson(json, type);
        if(savedPlants != null&&!savedPlants.isEmpty()){
            plantArrayList.addAll(savedPlants);
        }
    }
    private void setData(){
        plantArrayList.add(new Plant("Шиповник",6,
                "Предпочитает полное солнце (6–8 часов в день), но может расти в полутени. Лучше всего подходит рыхлая, дренированная, слабокислая или нейтральная почва (pH 5,5–7,0).\n" +
                "\n" +
                "Не переносит заболачивания – корни могут загнить. Перелив опаснее недолива! Проверяйте почву – если верхний слой (3–5 см) сухой, можно поливать.\n" +
                "\n" +
                "После полива мульчируйте (опилки, компост) для сохранения влаги. Весна (апрель): Азотные удобрения (мочевина, перегной) для роста зелени.\n" +
                "\n" +
                "Лето (июнь): Фосфорно-калийные (зола, суперфосфат) для цветения.\n" +
                "\n" +
                "Осень (сентябрь): Калий (калимагнезия) для подготовки к зиме.",R.drawable.images));
        plantArrayList.add(new Plant("Малина", 8,"Семейство: Розовые (Rosaceae)\n" +
                "\n" +
                "Тип: Листопадный полукустарник\n" +
                "\n" +
                "Высота: 1,5–2,5 м\n" +
                "\n" +
                "Побеги: Двухлетние (первый год – зелёные, второй – одревесневшие, плодоносящие)\n" +
                "\n" +
                "Листья: Овальные, зубчатые, зелёные сверху, белесые снизу\n" +
                "\n" +
                "Цветки: Белые, собраны в кисти\n" +
                "\n" +
                "Плоды: Сборные костянки (красные, жёлтые или чёрные в зависимости от сорта)\n" +
                "\n" +
                "Период плодоношения:\n" +
                "\n" +
                "Обычная малина – июнь-июль,\n"
                ,R.drawable.rasberry));
        plantArrayList.add(new Plant("Кактус",20, "Кактусы — это суккулентные растения, приспособленные к жизни в засушливых условиях. Их стебли покрыты толстой кожицей, уменьшающей испарение воды, а вместо листьев у большинства видов есть колючки, которые защищают от животных и помогают собирать влагу из воздуха. Кактусы отличаются разнообразием форм: они могут быть шаровидными, колонновидными, плоскими (например, опунции) или даже свисающими (как рипсалисы). Некоторые виды цветут яркими крупными цветами, часто неожиданно для владельца.\n" +
                "\n" +
                "Советы по уходу\n" +
                "Кактусы нуждаются в ярком солнечном свете — идеально подойдут южные или западные окна. Полив должен быть умеренным: летом — раз в 1–2 недели, зимой — раз в 3–4 недели или реже, чтобы имитировать естественный период покоя. Используйте хорошо дренированный грунт для суккулентов, чтобы избежать застоя воды. Пересаживайте кактус каждые 2–3 года, выбирая горшок чуть больше предыдущего. Избегайте сквозняков и резких перепадов температуры, хотя многие виды переносят прохладу зимой (до +10°C). Подкармливайте удобрением для кактусов только в период активного роста (весна–лето), не чаще раза в месяц.\n" +
                "\n" +
                "Важно: Если кактус вытягивается или бледнеет — ему не хватает света, а появление мягких пятен указывает на перелив. Колючки должны быть упругими, а стебель — твердым. При правильном уходе кактус может прожить десятилетия и даже зацвести.",R.drawable.cactus));
        plantArrayList.add(new Plant("Орхидея",11,"Орхидеи — одни из самых изысканных и разнообразных комнатных растений, известных своими необычными цветами и изящными формами. Большинство домашних орхидей относятся к роду Фаленопсис (орхидея-бабочка), но также популярны Дендробиумы, Каттлеи и Ванды. Их цветы могут быть белыми, розовыми, фиолетовыми, жёлтыми или даже пёстрыми, с причудливыми узорами. Листья у орхидей плотные, мясистые, часто с восковым налётом, а корни — воздушные, покрытые веламеном, который помогает впитывать влагу из воздуха.\n" +
                "\n" +
                "Советы по уходу\n" +
                "Орхидеи предпочитают яркий, но рассеянный свет — прямые солнечные лучи могут вызвать ожоги листьев. Идеальная температура — от +18°C до +25°C днём, с небольшим понижением ночью. Поливайте орхидею методом погружения: опускайте горшок в воду на 15–20 минут, затем дайте стечь излишкам. Частота полива зависит от субстрата — обычно раз в 7–10 дней. Используйте специальный грунт для орхидей (кора, мох, древесный уголь), обеспечивающий воздухопроницаемость. Влажность воздуха должна быть высокой (50–70%), поэтому полезно опрыскивать воздух вокруг растения или использовать увлажнитель.\n" +
                "\n" +
                "Подкармливайте орхидею удобрением для эпифитов раз в 2–3 недели в период роста, уменьшая дозировку в 2 раза от указанной на упаковке. После цветения обрежьте цветонос, если он начинает сохнуть, но оставьте его, если остаётся зелёным — возможно повторное цветение. Пересаживайте орхидею раз в 2–3 года, когда корни перерастают горшок или субстрат разлагается.\n" +
                "\n" +
                "Важно: Пожелтение листьев может указывать на перелив или недостаток света, а сморщенные корни — на нехватку влаги. Избегайте сквозняков и резких перепадов температуры. При правильном уходе орхидея может цвести несколько раз в год, радуя своей утончённой красотой.\n" +
                "New chat", R.drawable.orchid));
        plantArrayList.add(new Plant("Мак",8,"Мак — однолетнее или многолетнее травянистое растение, известное своими крупными, шелковистыми цветами с нежными, смятыми лепестками. Окраска варьируется от ярко-алой и розовой до белой, лиловой и почти черной. Сердцевина цветка украшена темными тычинками, окруженными россыпью пыльцы. Листья мака перисто-рассеченные, с сизым или зеленым оттенком, покрытые легким восковым налетом. После цветения образуется характерная коробочка с мелкими семенами.\n" +
                "\n" +
                "Советы по уходу\n" +
                "Мак предпочитает открытые солнечные участки с хорошо дренированной почвой, нейтральной или слабощелочной реакции. Он плохо переносит застой влаги, поэтому при посадке стоит избегать низин и тяжелых глинистых грунтов. Полив требуется умеренный, только в засушливые периоды, так как избыток воды приводит к загниванию корней. Подкормки минеральными удобрениями с низким содержанием азота вносят ранней весной и в период бутонизации.\n" +
                "\n" +
                "Семена мака высевают прямо в грунт осенью или ранней весной, так как растение не любит пересадку из-за стержневой корневой системы. Всходы прореживают, оставляя расстояние между растениями около 20–30 см. После цветения увядшие бутоны удаляют, если не планируется сбор семян. Многолетние виды мака могут зимовать без укрытия, но в регионах с суровыми зимами рекомендуется легкое мульчирование.\n" +
                "\n" +
                "Важно: В некоторых странах выращивание определенных видов мака регулируется законом из-за содержания алкалоидов. Перед посадкой уточните местные нормативы. Растение подвержено грибковым заболеваниям при повышенной влажности, поэтому важно соблюдать режим полива и обеспечить хорошую циркуляцию воздуха. При правильном уходе мак будет обильно цвести, создавая яркие акценты в саду.\n",R.drawable.poppy));
        plantArrayList.add(new Plant("Чай", 15,"Чайное растение (Camellia sinensis) — вечнозеленый кустарник или небольшое дерево, выращиваемое ради молодых листьев и почек, из которых производят чай. Листья темно-зеленые, кожистые, с зубчатыми краями, а цветы белые с желтыми тычинками, обладающие легким ароматом. В природе может достигать нескольких метров в высоту, но при культивировании обычно поддерживается в виде куста. Различают две основные разновидности: китайскую (Camellia sinensis var. sinensis) с мелкими листьями и ассамскую (Camellia sinensis var. assamica) с более крупными.\n" +
                "\n" +
                "Советы по уходу\n" +
                "Чайное растение предпочитает теплый и влажный климат с рассеянным солнечным светом, хотя может переносить и прямое солнце при достаточном поливе. Почва должна быть кислой (pH 5,5–6,5), рыхлой и хорошо дренированной, богатой органикой. Полив требуется регулярный, чтобы грунт оставался влажным, но не переувлажненным. В жаркую погоду полезно опрыскивать листья для поддержания влажности.\n" +
                "\n" +
                "Подкармливают чайный куст комплексными удобрениями с преобладанием азота весной и летом, сокращая подкормки к осени. Обрезка помогает поддерживать компактную форму и стимулирует рост новых побегов — ее проводят ранней весной, удаляя слабые и старые ветви. Зимой растение нуждается в защите от холода: при выращивании в открытом грунте в умеренных широтах требуется укрытие, а в северных регионах чай лучше содержать в контейнерах, перенося в помещение при понижении температуры ниже +5°C.\n" +
                "\n" +
                "Важно: Для получения качественного чайного листа первые два года после посадки урожай не собирают, давая растению окрепнуть. Сбор проводят вручную, срывая верхние молодые листья и почки. Чайное растение подвержено поражению паутинным клещом и тлей, поэтому важно регулярно осматривать листья и при необходимости обрабатывать инсектицидами. При правильном уходе куст может плодоносить десятилетиями, обеспечивая ароматным сырьем для домашнего чаепития.",R.drawable.tea));

    }

    public static void addInPlantList(Plant plant){
        plantArrayList.add(plant);
    }
}